require './editor.scss'

Viewer = require './viewer'

CommandHandler = require './commandhandler'
commandHandler = new CommandHandler()

Editor = window.Editor
Common = window.ObojoboDraft.Common
OBO = window.OBO

TextGroupCommandHandler = Editor.chunk.textChunk.TextGroupCommandHandler
TextGroup = Common.textGroup.TextGroup
Chunk = Common.models.Chunk
SelectionHandler = Common.chunk.textChunk.TextGroupSelectionHandler
NonEditableChunk = Common.chunk.NonEditableChunk
TextGroupEl = Common.chunk.textChunk.TextGroupEl

selectionHandler = new SelectionHandler()

Blockquote = React.createClass
	statics:
		type: 'ObojoboDraft.Chunks.Blockquote'
		register: ->
			OBO.registerChunk Blockquote, {
				insertItem:
					label: 'Block Quotation'
					icon: require 'svg-url?noquotes!./assets/insert-icon.svg'
					onInsert: Common.chunk.util.Insert
			}

		getCommandHandler: (chunk) -> commandHandler
		getSelectionHandler: (chunk) -> selectionHandler

		createNewNodeData: Viewer.createNewNodeData
		cloneNodeData: Viewer.cloneNodeData
		createNodeDataFromDescriptor: Viewer.createNodeDataFromDescriptor
		getDataDescriptor: Viewer.getDataDescriptor

	shouldComponentUpdate: ->
		@props.chunk.needsUpdate

	componentDidUpdate: ->
		@props.chunk.markUpdated()

	editCaption: ->
		@props.editChunk @props.chunk

	render: ->
		data = @props.chunk.modelState

		if @props.isEditing
			`<NonEditableChunk className='obojobo-draft--chunks--blockquote editor'>
				<div>
					<blockquote>
						<TextGroupEl text={data.textGroup.first.text} groupIndex='0' indent={data.textGroup.first.data.indent} />
					</blockquote>
				</div>
				<cite contentEditable="true">
					<TextGroupEl text={data.textGroup.last.text} groupIndex='1' indent={data.textGroup.last.data.indent} />

				</cite>
				<button onClick={this.editCaption}>Done</button>
			</NonEditableChunk>`
		else
			`<NonEditableChunk className='obojobo-draft--chunks--blockquote editor'>
				<div contentEditable="true">
					<blockquote>
						<TextGroupEl text={data.textGroup.first.text} groupIndex='0' indent={data.textGroup.first.data.indent} />
					</blockquote>
				</div>
				<cite>
					<TextGroupEl text={data.textGroup.last.text} groupIndex='1' indent={data.textGroup.last.data.indent} />
				</cite>
				<button onClick={this.editCaption}>Edit</button>
			</NonEditableChunk>`


Blockquote.register()

module.exports = Blockquote