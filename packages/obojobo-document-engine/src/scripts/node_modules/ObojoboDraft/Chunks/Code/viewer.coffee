require './viewer.scss'

Common = window.ObojoboDraft.Common
TextGroup = Common.textGroup.TextGroup
TextGroupEl = Common.chunk.textChunk.TextGroupEl
TextChunk = Common.chunk.TextChunk
SelectionHandler = Common.chunk.textChunk.TextGroupSelectionHandler

selectionHandler = new SelectionHandler()

Code = React.createClass
	statics:
		type: 'ObojoboDraft.Chunks.Code'
		register: -> OBO.registerChunk Code
		getSelectionHandler: (chunk) -> selectionHandler

		createNewNodeData: ->
			textGroup: TextGroup.create(Infinity, { indent:0 })
			type: 'p'

		cloneNodeData: (data) ->
			clone = data.textGroup.clone()

			textGroup: clone
			type: data.type

		createNodeDataFromDescriptor: (descriptor) ->
			textGroup: TextGroup.fromDescriptor descriptor.content.textGroup, Infinity, { indent:0 }
			type: descriptor.content.type

		getDataDescriptor: (chunk) ->
			data = chunk.modelState

			textGroup: data.textGroup.toDescriptor()
			type: data.type

	render: ->
		data = @props.chunk.modelState

		texts = data.textGroup.items.map (textItem, index) ->
			`<TextGroupEl text={textItem.text} groupIndex={index} indent={textItem.data.indent} key={index} />`

		`<TextChunk className="obojobo-draft--chunks--code pad">
			<pre><code>{texts}</code></pre>
		</TextChunk>`


Code.register()

module.exports = Code