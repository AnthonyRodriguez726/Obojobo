require './viewer.scss'

Image = require './image'
SelectionHandler = require './selectionhandler'

Common = window.ObojoboDraft.Common
TextGroup = Common.textGroup.TextGroup
TextGroupEl = Common.chunk.textChunk.TextGroupEl
NonEditableChunk = Common.chunk.NonEditableChunk
TextGroupSelectionHandler = Common.chunk.textChunk.TextGroupSelectionHandler

selectionHandler = new SelectionHandler()

Figure = React.createClass
	statics:
		type: 'ObojoboDraft.Chunks.Figure'
		register: ->
			OBO.registerChunk Figure
		getSelectionHandler: (chunk) -> selectionHandler

		createNewNodeData: ->
			tg = TextGroup.create(1)
			tg.first.text.styleText 'i'

			textGroup: tg
			url: null #'http://lorempixel.com/1024/760/'
			size: 'small'

		cloneNodeData: (data) ->
			textGroup: data.textGroup.clone()
			url: data.url
			size: data.size

		createNodeDataFromDescriptor: (descriptor) ->
			textGroup: TextGroup.fromDescriptor descriptor.content.textGroup, 1
			url: descriptor.content.url
			size: descriptor.content.size || 'small'

		getDataDescriptor: (chunk) ->
			data = chunk.modelState

			textGroup: data.textGroup.toDescriptor()
			url: data.url
			size: data.size

	render: ->
		data = @props.chunk.modelState

		`<NonEditableChunk className={'obojobo-draft--chunks--figure viewer ' + data.size} ref="component">
			<div className="container">
				<figure unselectable="on">
					<Image chunk={this.props.chunk} />
					{
						data.textGroup.first.text.length > 0
						?
						<figcaption ref="caption">
							<TextGroupEl text={data.textGroup.first.text} groupIndex="0" />
						</figcaption>
						:
						null
					}
				</figure>
			</div>
		</NonEditableChunk>`


Figure.register()

module.exports = Figure