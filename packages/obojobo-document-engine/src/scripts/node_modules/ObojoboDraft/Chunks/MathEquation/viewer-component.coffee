require './viewer-component.scss'

# katex = null #dynamically load
katex = require 'katex'

Common = window.ObojoboDraft.Common
OboComponent = Common.components.OboComponent
NonEditableChunk = Common.chunk.NonEditableChunk

getLatexHtml = (latex) ->
	try
		html = katex.renderToString latex, { displayMode:true }
		html: html
	catch e
		error: e


MathEquation = React.createClass
	getInitialState: ->
		katexHtml = getLatexHtml @props.model.modelState.latex
		if katexHtml.error?
			katexHtml = ''
		else
			katexHtml = katexHtml.html

		katexHtml: katexHtml

	render: ->
		if @state.katexHtml.length is 0
			return null

		`<OboComponent model={this.props.model} className={'obojobo-draft--chunks--math-equation pad align-' + (this.props.model.modelState.align)}>
			<NonEditableChunk >
				<div className="katex-container" dangerouslySetInnerHTML={{__html:this.state.katexHtml}} />
			</NonEditableChunk>
		</OboComponent>`


module.exports = MathEquation