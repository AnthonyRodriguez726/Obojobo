require './modal.scss'

DeleteButton = require 'ObojoboDraft/Common/components/deletebutton'

module.exports = React.createClass
	componentDidMount: ->
		if @props.onClose
			document.addEventListener 'keyup', @onKeyUp

	componentWillUnmount: ->
		if @props.onClose
			document.removeEventListener 'keyup', @onKeyUp

	onKeyUp: (event) ->
		if event.keyCode is 27 #ESC
			@props.onClose()

	onTabTrapFocus: ->
		if @props.onClose
			@refs.closeButton.focus()
		else if @props.focusOnFirstElement
			@props.focusOnFirstElement()

	render: ->
		`<div className="obojobo-draft--components--modal--modal">
			<input className="first-tab" ref="firstTab" type="text" onFocus={this.onTabTrapFocus} />
			{
				this.props.onClose
				?
				<DeleteButton ref="closeButton" onClick={this.props.onClose} />
				:
				null
			}
			<div className="content">
				{this.props.children}
			</div>
			<input className="last-tab" ref="lastTab" type="text" onFocus={this.onTabTrapFocus} />
		</div>`