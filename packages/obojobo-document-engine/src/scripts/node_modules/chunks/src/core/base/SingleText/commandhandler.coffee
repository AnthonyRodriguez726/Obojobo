TextGroupCommandHandler = Editor.command.TextGroupCommandHandler
TextGroupSelection = ObojoboDraft.text.TextGroupSelection

module.exports = class CommandHandler extends TextGroupCommandHandler
	splitText: (selection, chunk, shiftKey) ->
		chunk.markDirty()

		sel = new TextGroupSelection chunk, selection
		textGroup = chunk.componentContent.textGroup

		if sel.start.text.length is 0
			# If splitting an empty one item paragraph create a new paragraph below
			if textGroup.length is 1
				sibChunk = chunk.clone()
				sibChunk.componentContent.textGroup.init(1)

				chunk.addAfter sibChunk

				selection.setFutureCaret sibChunk, { offset: 0, groupIndex: 0 }

			# If splitting an empty textGroup item that's not a one item paragraph
			# then split into three paragraphs:
			else
				first = chunk
				middle = chunk.clone()
				last = chunk.clone()

				first.addAfter middle
				middle.addAfter last

				first.componentContent.textGroup.toSlice 0, sel.start.groupIndex
				middle.componentContent.textGroup.init(1)
				last.componentContent.textGroup.toSlice sel.start.groupIndex + 1

				if first.componentContent.textGroup.isEmpty
					first.remove()

				if last.componentContent.textGroup.isEmpty
					last.remove()

				selection.setFutureCaret middle, { offset: 0, groupIndex: 0 }

			return

		super selection, chunk, shiftKey
