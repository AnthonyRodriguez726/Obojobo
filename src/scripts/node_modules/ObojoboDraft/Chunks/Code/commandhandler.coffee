Editor = window.Editor;
Common = window.ObojoboDraft.Common;

TextGroupCommandHandler = Editor.chunk.textChunk.TextGroupCommandHandler
Chunk = Common.models.Chunk
TextGroupSelection = Common.textGroup.TextGroupSelection

module.exports = class CommandHandler extends TextGroupCommandHandler
	onEnter: (selection, chunk, shiftKey) ->
		chunk.markDirty()

		if not shiftKey
			chunk.splitText()
			return

		newChunk = Chunk.create()
		chunk.addChildAfter newChunk
		newChunk.selectStart()

	onSelectAll: (selection, chunk) ->
		chunk.selectAll()
		true

	deleteText: (selection, chunk, deleteForwards) ->
		chunk.markDirty()

		tgs = new TextGroupSelection chunk, selection.virtual
		data = chunk.modelState

		s = tgs.start

		if s.isTextStart and s.textGroupItem.data.indent > 0
			s.textGroupItem.data.indent--
			return

		super selection, chunk, deleteForwards


	# onTab: (selection, chunk, untab) ->
	# 	chunk.insertText "\t"

	indent: (selection, chunk, decreaseIndent) ->
		chunk.markDirty()

		data = chunk.modelState
		tgs = new TextGroupSelection chunk, selection.virtual

		all = tgs.getAllSelectedTexts()

		for textItem in all
			if textItem.data.indent? and not isNaN(textItem.data.indent)
				if not decreaseIndent
					textItem.data.indent++
				else if textItem.data.indent > 0
					textItem.data.indent--
