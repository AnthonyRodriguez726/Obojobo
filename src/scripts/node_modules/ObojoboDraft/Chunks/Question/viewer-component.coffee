require './viewer-component.scss'

ReactCSSTransitionGroup = React.addons.CSSTransitionGroup

Common = window.ObojoboDraft.Common

OboComponent = Common.components.OboComponent
Dispatcher = Common.flux.Dispatcher
FocusUtil = Common.util.FocusUtil
Button = Common.components.Button

ScoreUtil = window.Viewer.util.ScoreUtil
QuestionUtil = window.Viewer.util.QuestionUtil


Question = React.createClass
	onClickBlocker: ->
		QuestionUtil.viewQuestion @props.model.get('id')
		FocusUtil.focusComponent @props.model.get('id')

		# setTimeout (->
		# 	FocusUtil.unfocus()
		# 	QuestionUtil.hideQuestion @props.model.get('id')
		# ).bind(@), 5000

	render: ->
		score = ScoreUtil.getScoreForModel @props.moduleData.scoreState, @props.model
		viewState = QuestionUtil.getViewState @props.moduleData.questionState, @props.model

		`<OboComponent
			model={this.props.model}
			moduleData={this.props.moduleData}
			className={'flip-container obojobo-draft--chunks--question' + (score === null ? '' : (score === 100 ? ' is-correct' : ' is-incorrect')) + (' is-type-' + this.props.model.modelState.type) + ' is-' + viewState}
		>
			<div className="flipper">
				<div className="content back">
					{
						this.props.model.children.models.map((function(child, index) {
							var Component = child.getComponentClass()
							return <Component
								key={child.get('id')}
								model={child}
								moduleData={this.props.moduleData}
							/>
						}).bind(this))
					}
				</div>
				<div className="blocker front" key="blocker" onClick={this.onClickBlocker}>
					<Button value="Try question" />
				</div>
			</div>
		</OboComponent>`

module.exports = Question