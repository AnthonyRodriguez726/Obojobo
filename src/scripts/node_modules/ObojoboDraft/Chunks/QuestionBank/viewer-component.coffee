require './viewer-component.scss'

Common = window.ObojoboDraft.Common
OboComponent = Common.components.OboComponent
Dispatcher = Common.flux.Dispatcher
OboModel = Common.models.OboModel

AssessmentUtil = window.Viewer.util.AssessmentUtil

QuestionBank = React.createClass
	# componentWillMount: ->
	componentWillMount: ->
		assessment = AssessmentUtil.getAssessmentForModel @props.moduleData.assessmentState, @props.model
		if assessment

			if typeof assessment.current.data.get(@props.model.get('id')) is 'undefined'
				children = @props.model.children.models
				chosenChild = children[Math.floor(Math.random() * children.length)]

				AssessmentUtil.registerDataForAttempt @props.model, @props.model.get('id'), chosenChild.get('id')

	render: ->
		child = null
		Component = null

		assessment = AssessmentUtil.getAssessmentForModel @props.moduleData.assessmentState, @props.model

		if assessment
			childId = assessment.current.data.get @props.model.get('id')
			child = OboModel.models[childId]
			Component = child.getComponentClass()

		`<OboComponent
			model={this.props.model}
			className="obojobo-draft--chunks--question-bank"
		>
			{
				child
				?
				<Component model={child} moduleData={this.props.moduleData} />
				:
				null
			}
		</OboComponent>`

	onClick: ->
		this.forceUpdate();

module.exports = QuestionBank