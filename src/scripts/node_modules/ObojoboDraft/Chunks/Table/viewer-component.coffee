require './viewer-component.scss'

GridTextGroup = require './gridtextgroup'
SelectionHandler = require './selectionhandler'

Common = window.ObojoboDraft.Common
TextGroupEl = Common.chunk.textChunk.TextGroupEl
OboComponent = Common.components.OboComponent

Table = React.createClass
	render: ->
		model = @props.model
		data = model.modelState
		numCols = data.textGroup.numCols

		if data.header
			row = data.textGroup.items.slice(0, numCols).map ((textGroupItem, index) ->
				`<th
					key={index}
					className={'cell row-0 col-' + index}
					data-table-position={model.get('id') + ',0,' + index}
				>
					<TextGroupEl parentModel={this.props.model} text={textGroupItem.text} groupIndex={index} />
				</th>`
			).bind(@)

			header = `<tr key="header">
				{ row }
			</tr>`
		else
			header = null

		startIndex = if data.header then 1 else 0
		rows = [startIndex...data.textGroup.numRows].map ((rowNum) ->
			row = data.textGroup.items.slice(rowNum * numCols, (rowNum + 1) * numCols).map ((textGroupItem, index) ->
				`<td
					key={index}
					className={'cell row-' + rowNum + ' col-' + index}
					data-table-position={model.get('id') + ',' + rowNum + ',' + index}
				>
					<TextGroupEl parentModel={this.props.model} text={textGroupItem.text} groupIndex={rowNum * numCols + index} />
				</td>`
			).bind(@)

			`<tr key={rowNum}>
				{ row }
			</tr>`
		).bind(@)

		`<OboComponent model={this.props.model} moduleData={this.props.moduleData}>
			<div className="obojobo-draft--chunks--table viewer pad">
				<div className="container">
					<table
						className="view"
						ref="table"
						key="table"
					>
						<thead key="thead">
							{header}
						</thead>
						<tbody key="tbody">
							{rows}
						</tbody>
					</table>
				</div>
			</div>
		</OboComponent>`


module.exports = Table