Store = require 'ObojoboDraft/Common/flux/store'
Dispatcher = require 'ObojoboDraft/Common/flux/dispatcher'

TRANSITION_TIME_MS = 800
timeoutId = null

class FocusStore extends Store
	constructor: ->
		super('focusStore')

		Dispatcher.on 'focus:component', (payload) =>
			@state.viewState = 'enter'
			@state.focussedId = payload.value.id
			@triggerChange()

			window.clearTimeout timeoutId
			timeoutId = window.setTimeout (->
				@state.viewState = 'active'
				@triggerChange()
			).bind(@), TRANSITION_TIME_MS

		Dispatcher.on 'focus:unfocus', (payload) =>
			@state.viewState = 'leave'
			@triggerChange()

			window.clearTimeout timeoutId
			timeoutId = window.setTimeout (->
				@state.viewState = 'inactive'
				@state.focussedId = null
				@triggerChange()
			).bind(@), TRANSITION_TIME_MS

	init: ->
		@state = {
			focussedId: null
			viewState: 'inactive'
		}

	getState: -> @state

	setState: (newState) -> @state = newState


focusStore = new FocusStore()
module.exports = focusStore
