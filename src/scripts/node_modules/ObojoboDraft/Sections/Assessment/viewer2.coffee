ObojoboDraft = window.ObojoboDraft

AssessmentUtil = window.Viewer.util.AssessmentUtil


OBO.register 'ObojoboDraft.Sections.Assessment', {
	type: 'section',
	adapter: require('./adapter'),
	componentClass: require('./viewer-component'),
	selectionHandler: null,
	getNavItem: (model) ->
		title = model.title || 'Assessment'

		type: 'link'
		label: title
		path: [title.toLowerCase().replace(/ /g, '-')]
		showChildren: false
		showChildrenOnNavigation: false,
	variables: {
		'assessment:attemptsRemaining': (textModel, viewerProps) ->
			assessmentModel = textModel.getParentOfType 'ObojoboDraft.Sections.Assessment'
			if assessmentModel.modelState.attempts is Infinity then return 'unlimited'

			assessmentModel.modelState.attempts - AssessmentUtil.getNumberOfAttemptsCompletedForModel(viewerProps.assessmentState, textModel)
		'assessment:attemptsAmount': (textModel, viewerProps) ->
			assessmentModel = textModel.getParentOfType 'ObojoboDraft.Sections.Assessment'
			if assessmentModel.modelState.attempts is Infinity then return 'unlimited'

			assessmentModel.modelState.attempts
	}

	# generateNav: (model) ->
	# 	[
	# 		{
	# 			type: 'link',
	# 			label: model.title ||= 'Assessment',
	# 			id: model.get('id')
	# 		},
	# 		{
	# 			type: 'seperator'
	# 		}
	# 	]
}