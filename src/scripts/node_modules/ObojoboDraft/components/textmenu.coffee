require './textmenu.scss'


HEIGHT = 30
MARGIN = 20

TextMenu = React.createClass
	# getInitialState: ->
	# 	selectionRect: @props.selection.rect

	# componentWillReceiveProps: (nextProps) ->
	# 	@setState {
	# 		selectionRect: nextProps.selection.rect
	# 	}

	renderImg: (command) ->
		if not command.image? then return `<div><span>{command.label}</span><img className="click-blocker" /></div>`

		React.createElement 'img', { src:command.image, alt:command.label, title:command.label }

	onMouseDown: (label, event) ->
		console.log arguments

		event.preventDefault()
		event.stopPropagation()

		@props.commandHandler(label)

	render: ->
		console.log 'TM.r', @props

		if not @props.relativeToElement then return null
		if not @props.enabled then return null

		ctrlRect = @props.relativeToElement.getBoundingClientRect()
		selRect = @props.selectionRect
		renderImg = @renderImg

		if not selRect or not @props.commands or @props.commands.length is 0 then return null

		React.createElement('div', { className:'editor--components--text-menu', style: {
			left: (selRect.left + (selRect.width / 2) - ctrlRect.left) + 'px'
			top: (selRect.top - ctrlRect.top - MARGIN - HEIGHT) + 'px'
			height: HEIGHT + 'px'
		}},
			@props.commands.map ((command, index) ->
				React.createElement('a', {
					onMouseDown: @onMouseDown.bind(null, command.label)
					key: index
				}, renderImg(command))
			).bind(@)
		)


module.exports = TextMenu