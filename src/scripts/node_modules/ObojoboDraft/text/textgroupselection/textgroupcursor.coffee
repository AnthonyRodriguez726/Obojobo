Text = require 'ObojoboDraft/components/text'

getText = (textGroup, index) ->
	if isNaN(parseInt(index, 10)) or index < 0 or index >= textGroup.length then return null

	textGroup.get(index).text

class TextGroupCursor
	constructor: (textGroup, groupIndex, offset, styleIndex = -1) ->
		@textGroup = textGroup
		@groupIndex = groupIndex
		@offset = offset
		@text = getText textGroup, groupIndex
		@isAnchor = groupIndex is -1
		@styleIndex = styleIndex

	toObject: ->
		groupIndex: @groupIndex
		offset: @offset


Object.defineProperties TextGroupCursor.prototype, {
	isTextStart:
		"get": -> @offset is 0

	isTextEnd:
		"get": -> @offset is @text.length

	isFirstGroup:
		"get": -> @groupIndex is 0

	isLastGroup:
		"get": -> @groupIndex is @textGroup.length - 1

	isGroupStart:
		"get": -> @isTextStart and @isFirstGroup

	isGroupEnd:
		"get": -> @isTextEnd and @isLastGroup
}

TextGroupCursor.createFromCursor = (cursor) ->
	# console.log 'TGC.cFC', cursor
	if not cursor.isText then return null

	info = Text.getOboTextInfo cursor.textNode, cursor.offset

	new TextGroupCursor cursor.chunk.componentContent.textGroup, info.groupIndex, info.offset, info.styleIndex #, getText(cursor.chunk, info.groupIndex)


module.exports = TextGroupCursor