Text = require 'ObojoboDraft/components/text'

getItem = (textGroup, index) ->
	if isNaN(parseInt(index, 10)) or index < 0 or index >= textGroup.length then return null
	textGroup.get(index)

class TextGroupCursor
	constructor: (textGroup, groupIndex, offset) ->
		@textGroup = textGroup
		@groupIndex = groupIndex
		@offset = offset
		@textGroupItem = getItem textGroup, groupIndex
		@text = if @textGroupItem? then @textGroupItem.text else null
		@isAnchor = groupIndex is -1

	toObject: ->
		groupIndex: @groupIndex
		offset: @offset


Object.defineProperties TextGroupCursor.prototype, {
	isTextStart:
		"get": -> @offset is 0

	isTextEnd:
		"get": -> @offset is @text.length

	isFirstText:
		"get": -> @groupIndex is 0

	isLastText:
		"get": -> @groupIndex is @textGroup.length - 1

	isGroupStart:
		"get": -> @isTextStart and @isFirstText

	isGroupEnd:
		"get": -> @isTextEnd and @isLastText
}

TextGroupCursor.createFromCursor = (cursor) ->
	# console.log 'TGC.cFC', cursor
	if not cursor.isText then return null

	info = Text.getOboTextInfo cursor.textNode, cursor.offset

	new TextGroupCursor cursor.chunk.componentContent.textGroup, info.groupIndex, info.offset #, getText(cursor.chunk, info.groupIndex)


module.exports = TextGroupCursor