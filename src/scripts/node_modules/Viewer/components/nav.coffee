require './nav.scss'

navStore = require 'Viewer/stores/navstore'
NavUtil = require 'Viewer/util/navutil'
Logo = require 'Viewer/components/logo'

hamburgerImg = require 'svg-url?noquotes!./hamburger.svg'
arrowImg = require 'svg-url?noquotes!./arrow.svg'
lockImg = require 'svg-url?noquotes!./lock-icon.svg'

getBackgroundImage = window.ObojoboDraft.Common.util.getBackgroundImage

Nav = React.createClass
	getInitialState: ->
		hover: false

	onClick: (item) ->
		NavUtil.goto item.id

	hideNav: ->
		NavUtil.toggle()

	onMouseOver: ->
		@setState { hover:true }

	onMouseOut: ->
		@setState { hover:false }

	render: ->
		if @props.navState.open or @state.hover
			bg = getBackgroundImage(arrowImg)
		else
			bg = getBackgroundImage(hamburgerImg)

		if @props.navState.locked
			lockEl = `<div className="lock-icon"><img src={lockImg} /></div>`
		else
			lockEl = null

		`<div className={'viewer--components--nav' + (this.props.navState.locked ? ' is-locked' : ' is-unlocked') + (this.props.navState.open ? ' is-open' : ' is-closed') + (this.props.navState.disabled ? ' is-disabled' : ' is-enabled')}>
			<button
				className="toggle-button"
				onClick={this.hideNav}
				onMouseOver={this.onMouseOver}
				onMouseOut={this.onMouseOut}
				style={
					{
						backgroundImage: bg,
						transform: ((!this.props.navState.open && this.state.hover) ? 'rotate(180deg)' : ''),
						filter: ((this.props.navState.open) ? 'invert(100%)' : 'invert(0%)')
					}
				}
			>
				Toggle Navigation Menu
			</button>
			<ul>
				{
					this.props.navState.items.map((function(item, index) {
						switch(item.type)
						{
							case 'heading':
								var isSelected = false
								return <li key={index} className={'heading' + (isSelected ? ' is-selected' : ' is-not-select')}><a>{item.label}</a></li>
								break;

							case 'link':
								var isSelected = this.props.navState.navTargetIndex === index
								return <li key={index} onClick={this.onClick.bind(null, item)} className={'link' + (isSelected ? ' is-selected' : ' is-not-select')}>
									<a>{item.label}</a>
									{lockEl}
								</li>
								break;

							case 'seperator':
								return <li key={index} className='seperator'><hr /></li>
								break;

						}

					}).bind(this))
				}
			</ul>
			<Logo inverted />
		</div>`


module.exports = Nav