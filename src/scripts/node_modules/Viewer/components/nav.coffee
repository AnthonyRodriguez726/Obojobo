require './nav.scss'

NavStore = require 'Viewer/stores/navstore'
hamburgerImg = require 'svg-url?noquotes!./hamburger.svg'
arrowImg = require 'svg-url?noquotes!./arrow.svg'

Dispatcher = window.ObojoboDraft.Common.flux.Dispatcher
getBackgroundImage = window.ObojoboDraft.Common.util.getBackgroundImage

Nav = React.createClass
	getInitialState: ->
		hover: false

	onClick: (item) ->
		Dispatcher.dispatch {
			type: 'navGoto',
			value: item.value
		}

	hideNav: ->
		Dispatcher.dispatch {
			type: 'navToggle'
		}

	onMouseOver: ->
		@setState { hover:true }

	onMouseOut: ->
		@setState { hover:false }

	render: ->
		if @props.navState.open or @state.hover
			bg = getBackgroundImage(arrowImg)
		else
			bg = getBackgroundImage(hamburgerImg)

		`<div className={'viewer--components--nav' + (this.props.navState.locked ? ' is-locked' : ' is-unlocked') + (this.props.navState.open ? ' is-open' : ' is-closed') + (this.props.navState.disabled ? ' is-disabled' : ' is-enabled')}>
			<button
				className="toggle-button"
				onClick={this.hideNav}
				onMouseOver={this.onMouseOver}
				onMouseOut={this.onMouseOut}
				style={
					{
						backgroundImage: bg,
						transform: ((!this.props.navState.open && this.state.hover) ? 'rotate(180deg)' : '')
					}
				}
			>
				Toggle Navigation Menu
			</button>
			<ul>
				{
					this.props.navState.items.map((function(item, index) {
						switch(item.type)
						{
							case 'link':
								var isSelected = this.props.navState.navTarget === item
								return <li key={index} onClick={this.onClick.bind(null, item)} className={'link' + (isSelected ? ' is-selected' : ' is-not-select')}><a>{item.label}</a></li>
								break;

							case 'seperator':
								return <li key={index} className='seperator'><hr /></li>
								break;

						}

					}).bind(this))
				}
			</ul>
		</div>`


module.exports = Nav