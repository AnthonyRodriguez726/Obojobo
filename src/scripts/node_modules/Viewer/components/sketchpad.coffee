require './sketchpad.scss'

require 'literallycanvas/lib/js/literallycanvas-core'

Sketchpad = React.createClass
	getInitialState: ->
		@boundMouseMove = @onDocMouseMove.bind(@)
		@boundMouseUp = @onDocMouseUp.bind(@)

		left: 0
		top: 0

	componentDidMount: ->
		@lc = LC.init @refs.canvas
		window.__lc = @lc
		@lc.tool.strokeWidth = 2

		@Pencil = new @lc.opts.tools[0](@lc)
		@Eraser = new @lc.opts.tools[1](@lc)

	usePencil: ->
		@lc.tool = @Pencil

	useEraser: ->
		@lc.tool = @Eraser

	setStrokeWidth: (strokeWidth) ->
		console.log('ARGGGGG', arguments)
		@lc.tool.strokeWidth = strokeWidth

	setColor: (color) ->
		@lc.setColor 'primary', color

	undo: ->
		@lc.undo()

	redo: ->
		@lc.redo()


	onDocMouseMove: (event) ->
		@setState({
			left: @state.left + (event.screenX - @x),
			top: @state.top + (event.screenY - @y)
		})

		@x = event.screenX
		@y = event.screenY

	onDocMouseUp: (event) ->
		delete @x
		delete @y

		window.document.removeEventListener('mousemove', @boundMouseMove)
		window.document.removeEventListener('mouseup', @boundMouseUp)

	startDrag: (event) ->
		@x = event.screenX
		@y = event.screenY

		window.document.addEventListener('mousemove', @boundMouseMove)
		window.document.addEventListener('mouseup', @boundMouseUp)

	render: ->
		`<div className={'viewer--components--sketchpad'} style={{ left:this.state.left, top:this.state.top }}>
			<div className="handle" onMouseDown={this.startDrag}>Sketchpad</div>
			<div ref="canvas" className="lc" />
			<div className="toolbar">
				<button onClick={this.usePencil}>Pencil</button>
				<button onClick={this.useEraser}>Eraser</button>
				<button onClick={this.setStrokeWidth.bind(null, 1)}>Width 1</button>
				<button onClick={this.setStrokeWidth.bind(null, 2)}>Width 2</button>
				<button onClick={this.setStrokeWidth.bind(null, 5)}>Width 5</button>
				<button onClick={this.setStrokeWidth.bind(null, 10)}>Width 10</button>
				<button onClick={this.setColor.bind(null, 'black')}>Black</button>
				<button onClick={this.setColor.bind(null, 'red')}>Red</button>
				<button onClick={this.setColor.bind(null, 'blue')}>Blue</button>
				<button onClick={this.setColor.bind(null, 'green')}>Green</button>
				<button onClick={this.undo}>Undo</button>
				<button onClick={this.redo}>Redo</button>
			</div>
		</div>`


module.exports = Sketchpad