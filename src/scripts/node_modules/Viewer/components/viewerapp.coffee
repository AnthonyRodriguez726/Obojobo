require './viewerapp.scss'

ViewerPage = require './viewerpage'

ObojoboDraft = window.ObojoboDraft
VirtualSelection = ObojoboDraft.selection.VirtualSelection;
DOMSelection = ObojoboDraft.selection.DOMSelection;
TextGroupEl = ObojoboDraft.chunk.textChunk.TextGroupEl

ViewerApp = React.createClass
	getInitialState: ->


		# FakeSelectionClass = (module) ->
		# 	this.savedSelection = null;
		# 	this.virtual = new VirtualSelection(module);
		# 	this.dom = null;

		# FakeSelectionClass.prototype.saveVirtualSelection = ->
		# 	this.savedSelection = module.editor.state.selection.virtual.clone();

		# FakeSelectionClass.prototype.restoreVirtualSelection = ->
		# 	module.editor.state.selection.virtual = this.savedSelection;

		# Object.defineProperties(FakeSelectionClass.prototype, {
		# 	startChunk:
		# 		get: ->
		# 			console.log('SC');
		# 			if(!module.editor.state.selection.virtual.start)
		# 				return null;

		# 			return module.editor.state.selection.virtual.start.chunk;
		# 	endChunk:
		# 		get: ->
		# 			if(!module.editor.state.selection.virtual.end)
		# 				return null;

		# 			return module.editor.state.selection.virtual.end.chunk;
		# });

		@virtual = new VirtualSelection(this.props.module);
		@savedSel = null
		window.__saveSel = (->
			console.log('save sel', @virtual)
			@virtual.fromDOMSelection();
			@savedSel = @virtual.clone();
		).bind(@)
		window.__restoreSel = (->
			console.log(@savedSel)
			s = TextGroupEl.getDomPosition @savedSel.start
			e = TextGroupEl.getDomPosition @savedSel.end
			DOMSelection.set s.textNode, s.offset, e.textNode, e.offset
		).bind(@)

		@props.module.editor = @

		# selection: new FakeSelectionClass(@props.module)
		# module: @props.module

	render: ->
		window.__state = @state
		#<Modal modalElement={this.state.modalElement} showModalFn={showModalFn} />
		#<LoadingModal show={this.state.loading} />

		`<div className="viewer--components--viewer-app">
			<main ref="main">
				<div className='wrapper'>
					<ViewerPage
						module={this.props.module}
						ref="viewerPage"
					/>
				</div>
			</main>

		</div>`


module.exports = ViewerApp