Store = window.ObojoboDraft.Common.flux.Store
Dispatcher = window.ObojoboDraft.Common.flux.Dispatcher

state = {
	scores: {},
	viewed: {},
	viewing: null
}

ScoreStore = Object.assign(new Store(),
	getState: -> state

	setState: (newState) -> state = newState

	getScore: (model) ->
		score = state.scores[model.get('id')]
		if typeof score is 'undefined' then return null

		score
)

ScoreStore.dispatchToken = Dispatcher.register (payload) ->
	switch payload.type
		when 'score:set'
			state.scores[payload.value.id] = payload.value.score

		when 'score:clear'
			delete state.scores[payload.value.id]

		when 'score:viewQuestion'
			state.viewing = payload.value.id
			state.viewed[state.viewing] = true

	ScoreStore.emitChange()


module.exports = ScoreStore