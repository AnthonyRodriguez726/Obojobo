require './break.scss'

ObojoboDraft = require 'ObojoboDraft'

TextMethods = ObojoboDraft.text.TextMethods
POS = ObojoboDraft.text.TextPositionMethods
Chunk = ObojoboDraft.models.Chunk
NonEditableChunk = ObojoboDraft.components.NonEditableChunk


Break = React.createClass
	statics:
		type: 'ObojoboDraft.Chunks.Break'
		getCommandHandler: -> null

		# OBONODE DATA METHODS
		# ================================================
		createNewNodeData: -> {}
		cloneNodeData: (data) -> {}

		# SERIALIZATION/DECODE METHODS
		# ================================================
		createNodeDataFromDescriptor: (descriptor) -> {}
		getDataDescriptor: (chunk) -> {}

		# HTML METHODS
		# ================================================
		createNewNodesFromElement: (el) -> [Chunk.create @]

	# shouldComponentUpdate: ->
	# 	@props.chunk.needsUpdate

	# componentDidUpdate: ->
	# 	@props.chunk.markUpdated()

	render: ->
		`<NonEditableChunk className="obojobo-draft--chunks--break">
			<hr />
		</NonEditableChunk>`


OBO.registerChunk Break, {
	insertItem:
		label: 'Break'
		icon: require 'svg-url?noquotes!./assets/insert-icon.svg'
		onInsert: (componentClass, position, referenceChunk, selection, callback) ->
			newChunk = Chunk.create componentClass
			focusChunk = null

			switch position
				when 'before'
					referenceChunk.addBefore newChunk

					if newChunk.isFirst()
						focusChunk = Chunk.create()
						newChunk.addBefore focusChunk
					else
						focusChunk = newChunk.prevSibling()

				when 'after'
					referenceChunk.addAfter newChunk

					if newChunk.isLast()
						focusChunk = Chunk.create()
						newChunk.addAfter focusChunk
					else
						focusChunk = newChunk.nextSibling()

			focusChunk.selectEnd selection

			callback()
}

module.exports = Break