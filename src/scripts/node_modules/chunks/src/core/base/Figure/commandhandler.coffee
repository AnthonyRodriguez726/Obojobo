TextGroupCommandHandler = Editor.command.TextGroupCommandHandler

ObojoboDraft = window.ObojoboDraft
TextGroupSelection = ObojoboDraft.text.TextGroupSelection
Chunk = ObojoboDraft.models.Chunk
FocusableCommandHandler = ObojoboDraft.command.FocusableCommandHandler

module.exports = class CommandHandler extends TextGroupCommandHandler
	splitText: (selection, chunk, shiftKey) ->
		console.log 'splitText', arguments
		chunk.markDirty()

		# info = POS.getCaretInfo selection.chunk.start, chunk
		tgs = new TextGroupSelection chunk, selection.virtual

		newText = tgs.start.text.split tgs.start.offset

		newNode = Chunk.create() #@TODO - assumes it has a textGroup
		newNode.componentContent.textGroup.first.text = newText
		chunk.addChunkAfter newNode

		# selection.setFutureCaret newNode, { offset: 0, groupIndex: 0 }
		# TextGroupSelection.setCaretToGroupStart newNode, selection.virtual
		newNode.selectStart()

	deleteText: (selection, chunk, deleteForwards) ->
		tgs = new TextGroupSelection chunk, selection.virtual
		s = tgs.start

		if not deleteForwards and s.isGroupStart then return false
		if deleteForwards and s.isGroupEnd then return true

		super selection, chunk, deleteForwards

	selectStart: (selection, chunk) ->
		FocusableCommandHandler.prototype.selectStart selection, chunk

	paste: (selection, chunk, text, html) ->
		@insertText selection, chunk, text

	canMergeWith: (selection, chunk, otherChunk) ->
		super(selection, chunk,otherChunk) and chunk.nextSibling() is otherChunk

	canRemoveSibling: (selection, sibling) -> false

	onSelectAll: (selection, chunk) ->
		TextGroupSelection.selectText chunk, 0, selection
		true