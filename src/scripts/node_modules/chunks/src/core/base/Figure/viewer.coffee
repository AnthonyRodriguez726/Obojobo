require './viewer.scss'

Image = require './image'
SelectionHandler = require './selectionhandler'

ObojoboDraft = window.ObojoboDraft
TextGroup = ObojoboDraft.textGroup.TextGroup
TextGroupEl = ObojoboDraft.chunk.textChunk.TextGroupEl
NonEditableChunk = ObojoboDraft.chunk.NonEditableChunk
TextGroupSelectionHandler = ObojoboDraft.chunk.textChunk.TextGroupSelectionHandler

selectionHandler = new SelectionHandler()

Figure = React.createClass
	statics:
		type: 'ObojoboDraft.Chunks.Figure'
		register: ->
			OBO.registerChunk Figure
		getSelectionHandler: (chunk) -> selectionHandler

		createNodeDataFromDescriptor: (descriptor) ->
			textGroup: TextGroup.fromDescriptor descriptor.content.textGroup, 1
			url: descriptor.content.url
			size: descriptor.content.size

	render: ->
		data = @props.chunk.componentContent

		`<NonEditableChunk className={'obojobo-draft--chunks--figure viewer ' + data.size} ref="component">
			<div className="container">
				<figure unselectable="on">
					<Image chunk={this.props.chunk} />
					{
						data.textGroup.first.text.length > 0
						?
						<figcaption ref="caption">
							<TextGroupEl text={data.textGroup.first.text} groupIndex="0" />
						</figcaption>
						:
						null
					}
				</figure>
			</div>
		</NonEditableChunk>`



module.exports = Figure