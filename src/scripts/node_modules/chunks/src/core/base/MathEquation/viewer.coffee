# katex = null #dynamically load
katex = require 'katex'

ObojoboDraft = window.ObojoboDraft
NonEditableChunk = ObojoboDraft.components.NonEditableChunk


getLatexHtml = (latex) ->
	try
		html = katex.renderToString latex, { displayMode:true }
		html: html
	catch e
		error: e


MathEquation = React.createClass
	statics:
		type: 'ObojoboDraft.Chunks.MathEquation'
		register: ->
			OBO.registerChunk MathEquation, {
				dependencies: ['https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css']
			}

		DEFAULT_LATEX: ''
		getCommandHandler: -> null

		createNodeDataFromDescriptor: (descriptor) ->
			content = descriptor.content

			latex: content.latex

	getInitialState: ->
		katexHtml = getLatexHtml @props.chunk.componentContent.latex
		if katexHtml.error?
			katexHtml = ''
		else
			katexHtml = katexHtml.html

		katexHtml: katexHtml

	render: ->
		if @state.katexHtml.length is 0
			return null

		`<NonEditableChunk className="obojobo-draft--chunks--math-equation pad">
			<div className="katex-container" dangerouslySetInnerHTML={{__html:this.state.katexHtml}} />
		</NonEditableChunk>`


module.exports = MathEquation