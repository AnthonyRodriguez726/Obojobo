TextGroupCommandHandler = Editor.command.TextGroupCommandHandler
TextGroupSelection = ObojoboDraft.text.TextGroupSelection

module.exports = class CommandHandler extends TextGroupCommandHandler
	splitText: (selection, chunk, shiftKey) ->
		chunk.markDirty()

		sel = new TextGroupSelection chunk, selection
		textGroup = chunk.componentContent.textGroup

		if sel.start.text.length is 0
			# If splitting an empty one item paragraph create a new paragraph below
			if textGroup.length is 1
				sibChunk = chunk.clone()
				sibChunk.componentContent.textGroup.init(1)

				chunk.addAfter sibChunk

				selection.setFutureCaret sibChunk, { offset: 0, groupIndex: 0 }

			# If splitting an empty textGroup item that's not a one item paragraph
			# then split into three paragraphs:
			else
				splitChildren = chunk.split selection

				if splitChildren.prev?
					prev = splitChildren.prev
					tg = prev.componentContent.textGroup
					tg.remove tg.length - 1
					if tg.isEmpty
						prev.remove()

				if splitChildren.next?
					next = splitChildren.next
					tg = next.componentContent.textGroup
					tg.remove 0
					if tg.isEmpty
						next.remove()

			return

		super selection, chunk, shiftKey
