require './sidemenulist.scss'

ComponentClassMap = require('ObojoboDraft').util.ComponentClassMap

WIDTH = 30
HEIGHT = 30
MENU_OPEN_DURATION_MS = 100

SideMenuList = React.createClass
	getInitialState: ->
		open: false

	open: ->
		clearTimeout @timeoutId
		@setState { open:true }

	close: ->
		@timeoutId = setTimeout (->
			@setState { open:false }
		).bind(@), MENU_OPEN_DURATION_MS

	onMouseDown: (componentClass) ->
		@close()
		@props.onMouseDown componentClass

	render: ->
		onMouseDown = @onMouseDown

		children = []
		self = @
		@props.inserts.forEach (insert, index) ->
			componentClass = ComponentClassMap.getClassForType insert.chunk
			children.push React.createElement('button', {
				onMouseDown: (event) ->
					event.preventDefault()
					self.onMouseDown.bind(self, componentClass)()
				key: index
			}, "#{insert.label}")

		React.createElement('div', {
			className: 'editor--components--side-menu--side-menu-list ' + (if @state.open then 'open' else '')
			onMouseOver:@open,
			onMouseOut:@close,
			style: {
				position: 'absolute'
				left: -WIDTH / 2
				top: @props.yPos + 'px'
				zIndex: 100
			}},
			React.createElement('div', {
				className:'insert-button',
				style: {
					width: WIDTH + 'px'
					height: HEIGHT + 'px'
					display: 'inline-block'
					verticalAlign: 'middle'
				}}, '+'),
			React.createElement('div', {
				className:'insert-list',
				style: {
					display: (if @state.open then 'inline-block' else 'none')
					verticalAlign: 'middle'
				}}, children)
		)


module.exports = SideMenuList