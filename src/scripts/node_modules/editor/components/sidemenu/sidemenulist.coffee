require './sidemenulist.scss'

ObojoboDraft = require 'ObojoboDraft'
ComponentClassMap = ObojoboDraft.util.ComponentClassMap
Assets = ObojoboDraft.Assets

WIDTH = 30
HEIGHT = 30
MENU_OPEN_DURATION_MS = 100

SideMenuList = React.createClass
	getInitialState: ->
		open: false
		hoveredLabel: null

	open: ->
		clearTimeout @timeoutId
		@setState { open:true }

	close: ->
		@timeoutId = setTimeout (->
			@setState {
				open: false
				hoveredLabel: null
			}
		).bind(@), MENU_OPEN_DURATION_MS

	onMouseDown: (componentClass) ->
		@close()
		@props.onMouseDown componentClass

	setHoveredLabel: (label) ->
		@setState { hoveredLabel:label }

	render: ->
		onMouseDown = @onMouseDown
		children = []
		self = @
		setHoveredLabel = @setHoveredLabel
		@props.inserts.forEach (insert, index) ->
			componentClass = ComponentClassMap.getClassForType insert.chunk
			mouseDown = (event) ->
				event.preventDefault()
				self.onMouseDown.bind(self, componentClass)()
			styles =
				backgroundImage: Assets.getBackgroundImage(Assets[insert.img])
			children.push `<button className="side-menu-button"
								key={index}
								onMouseOver={setHoveredLabel.bind(null, insert.label)}
								onMouseOut={setHoveredLabel.bind(null, null)}
								onMouseDown={mouseDown}
								style={styles}
							>
								{insert.label}
							</button>`

		`<div
			className={'editor--components--side-menu--side-menu-list' + (this.state.open ? ' open' : '')}
			onMouseOver={this.open}
			onMouseOut={this.close}
			style={{top: this.props.yPos + 'px'}}
		>
			<div className="insert-button">+</div>
			<div className="insert-list" style={{display: (this.state.open ? 'inline-block' : 'none')}}>{children}</div>
			<div className="label">{this.state.hoveredLabel}</div>
		</div>`


module.exports = SideMenuList