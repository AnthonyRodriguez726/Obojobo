# Utility methods for dealing with chunks

send = (fn, chunkOrChunks, selection, data = []) ->
	if not (chunkOrChunks instanceof Array)
		return chunkOrChunks.callComponentFn fn, selection, data

	chunks = chunkOrChunks
	results = []
	for chunk in chunks
		results.push chunk.callComponentFn fn, selection, data

	results


deleteSelection = (selection) ->
	return if selection.chunk.type is 'caret'

	for node in selection.chunk.inbetween
		node.remove()

	send 'deleteSelection', selection.chunk.start.chunk, selection

	if selection.chunk.type is 'chunkSpan'
		send 'deleteSelection', selection.chunk.end.chunk, selection
		if send('canMergeWith', selection.chunk.end.chunk, selection, [selection.chunk.start.chunk])
			send 'merge', selection.chunk.start.chunk, selection, [selection.chunk.end.chunk]

	selection.chunk.collapse()


activateStyle = (style, selection, styleBrush) ->
	if selection.chunk.type is 'caret'
		styleBrush.add style, selection.styles[style]?
	else
		if selection.styles[style]?
			send 'unstyleSelection', selection.chunk.all, selection, [style]
		else
			send 'styleSelection', selection.chunk.all, selection, [style]


module.exports = {
	send: send
	deleteSelection: deleteSelection
	activateStyle: activateStyle
}